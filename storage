<body>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Mobile Top Bar -->
    <div class="top-bar-mobile">
        <div class="flex items-center gap-3">
            <button id="mobileSidebarToggle" class="text-white">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <div class="logo-circle">
                <span style="color: white; font-weight: 900; font-size: 16px;">OF</span>
            </div>
            <span style="font-size: 1.2rem; font-weight: 800; background: linear-gradient(90deg, #E638B5, #9333EA); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">OFLeaks.tv</span>
        </div>
        <div class="flex items-center gap-2">
            <div class="mobile-notification-bell notification-bell-container">
                <div class="notification-bell" onclick="toggleNotificationDropdown(event)">
                    <i class="fas fa-bell text-xl"></i>
                    <span class="notification-badge" id="mobileNotificationBadge" style="display: none;">0</span>
                </div>
                <div class="notification-dropdown" id="mobileNotificationDropdown">
                    <div class="notification-header">
                        <h3>Benachrichtigungen</h3>
                        <div class="notification-header-actions">
                            <button class="notification-mark-all" onclick="markAllNotificationsAsRead()">Alle als gelesen</button>
                            <button class="notification-delete-all" onclick="deleteAllNotifications()">Alle l√∂schen</button>
                        </div>
                    </div>
                    <div class="notification-list" id="mobileNotificationList">
                        <div class="notification-empty">
                            <i class="fas fa-bell-slash"></i>
                            <p>Keine Benachrichtigungen</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <!-- Logo -->
        <a href="home.html" class="sidebar-logo" style="text-decoration: none;">
            <div class="logo-icon">
                <div class="logo-circle" style="animation: pulse-shadow 2s infinite;">
                    <span style="color: white; font-weight: 900; font-size: 18px; letter-spacing: -1px;">OF</span>
                    <span class="premium-indicator">VIP</span>
                </div>
            </div>
            <div class="logo-text">
                <span style="font-size: 1.7rem; font-weight: 900; line-height: 1; background: linear-gradient(90deg, #ff007f, #a145ff); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -0.5px; filter: drop-shadow(0 2px 3px rgba(255, 0, 127, 0.3));">
                    OFLeaks<span style="color: white; -webkit-text-fill-color: white;">.tv</span>
                </span>
                <span style="font-size: 0.7rem; color: rgba(255,255,255,0.6); margin-left: auto;">Premium Content</span>
            </div>
        </a>

        <!-- Search -->
        <div class="search-container" style="position: relative;">
            <i class="fas fa-search search-icon"></i>
                        <input type="search" id="search" name="search" class="search-input" placeholder="Suche..." autocomplete="off" disabled style="cursor: not-allowed; opacity: 0.5;">
            <p style="font-size: 0.7rem; color: rgba(255, 255, 255, 0.5); margin-top: 4px; text-align: center;">Du ben√∂tigst einen Rang zum Suchen</p>
                    </div>

        <!-- Online Counter -->
        <div class="online-counter">
            <div class="online-dot"></div>
            <span>
                133 online            </span>
        </div>

        <!-- Main Navigation -->
        <div class="nav-section">
            <div class="nav-section-title" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Hauptmen√º</span>
                <div class="notification-bell-container" style="margin-left: auto;">
                    <div class="notification-bell" onclick="toggleNotificationDropdown(event)">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="desktopNotificationBadge" style="display: none;">0</span>
                    </div>
                    <div class="notification-dropdown" id="desktopNotificationDropdown">
                        <div class="notification-header">
                            <h3>Benachrichtigungen</h3>
                            <div class="notification-header-actions">
                                <button class="notification-mark-all" onclick="markAllNotificationsAsRead()">Alle als gelesen</button>
                                <button class="notification-delete-all" onclick="deleteAllNotifications()">Alle l√∂schen</button>
                            </div>
                        </div>
                        <div class="notification-list" id="desktopNotificationList">
                            <div class="notification-empty">
                                <i class="fas fa-bell-slash"></i>
                                <p>Keine Benachrichtigungen</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <a href="home.html" class="nav-item active">
                <div class="nav-item-icon">üè†</div>
                <div class="nav-item-text">Startseite</div>
            </a>
                        <a href="referral-program.html" class="nav-item nav-item-free-access " onclick="trackReferralSidebarClick(event)">
                <div class="nav-item-icon">üéÅ</div>
                <div class="nav-item-text">Kostenlos Zugang</div>
            </a>
                        <a href="customdl.html" class="nav-item ">
                <div class="nav-item-icon">üì•</div>
                <div class="nav-item-text">Downloader</div>
            </a>
            <a href="undress.html" class="nav-item " style="position: relative; overflow: hidden;">
                <div class="nav-item-icon">‚ú®</div>
                <div class="nav-item-text" style="background: linear-gradient(90deg, #8b5cf6, #ec4899, #8b5cf6); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: gradient-shift 3s ease infinite; font-weight: 600;">AI Undress</div>
                <span style="position: absolute; top: 8px; right: 8px; background: linear-gradient(135deg, #8b5cf6, #ec4899); color: white; font-size: 9px; padding: 2px 6px; border-radius: 10px; font-weight: bold; animation: pulse-glow 2s ease-in-out infinite;">NEU</span>
            </a>
            <a href="noaccess.html" class="nav-item ">
                <div class="nav-item-icon">üîû</div>
                <div class="nav-item-text">Leaks</div>
            </a>
            <a href="enhance.html" class="nav-item ">
                <div class="nav-item-icon">‚ú®</div>
                <div class="nav-item-text">AI Enhancer</div>
            </a>
            <a href="noaccess.html" class="nav-item ">
                <div class="nav-item-icon">üé•</div>
                <div class="nav-item-text">PornTok</div>
            </a>
            <a href="noaccess.html" class="nav-item ">
                <div class="nav-item-icon">üçÜ</div>
                <div class="nav-item-text">Porn Videos</div>
            </a>
                    </div>

        <!-- Categories Dropdown -->
        <div class="nav-section">
            <div class="nav-section-title">Kategorien</div>
            <div class="nav-item" id="categoriesToggle" style="cursor: pointer;">
                <div class="nav-item-icon">üìÇ</div>
                <div class="nav-item-text">Alle Kategorien</div>
                <div class="nav-item-chevron">
                    <i class="fas fa-chevron-right" style="font-size: 12px;"></i>
                </div>
            </div>

<div class="nav-item-submenu" id="categoriesSubmenu">
  <a href="home.html?c=0" class="nav-item" style="padding-left:24px; text-decoration:none;">
    <div class="nav-item-icon" style="font-size:16px;">üåê</div>
    <div class="nav-item-text">Main</div>
  </a>

  <a href="home.html?c=1" class="nav-item" style="padding-left:24px; text-decoration:none;">
    <div class="nav-item-icon" style="font-size:16px;">‚ú®</div>
    <div class="nav-item-text">Beliebt</div>
  </a>

  <a href="fehler.html" class="nav-item" style="padding-left:24px; text-decoration:none;">
    <div class="nav-item-icon" style="font-size:16px;">‚ù§Ô∏è</div>
    <div class="nav-item-text">Favoriten</div>
  </a>

  <a href="home.html?c=27" class="nav-item" style="padding-left:24px; text-decoration:none;">
    <div class="nav-item-icon" style="font-size:16px;">üíô</div>
    <div class="nav-item-text">OnlyFans</div>
  </a>

  <a href="home.html?c=29" class="nav-item" style="padding-left:24px; text-decoration:none;">
    <div class="nav-item-icon" style="font-size:16px;">üá©üá™</div>
    <div class="nav-item-text">Deutsche</div>
  </a>

  <a href="fehler.html" class="nav-item" style="padding-left:24px; text-decoration:none;">
    <div class="nav-item-icon" style="font-size:16px;">üìÅ</div>
    <div class="nav-item-text">Mega Post</div>
  </a>
</div>



        <!-- Shop Navigation -->
        <div class="nav-section">
            <div class="nav-section-title">Shop</div>
            
            <a href="rankupgrade.html" class="nav-item">
                <div class="nav-item-icon">üíé</div>
                <div class="nav-item-text">Rang Shop</div>
            </a>
            <a href="rankupgrade.html" class="nav-item">
                <div class="nav-item-icon">‚¨ÜÔ∏è</div>
                <div class="nav-item-text">Rang Upgraden</div>
            </a>
        </div>

        <!-- Extras -->
        <div class="nav-section">
            <div class="nav-section-title">Extras</div>
            <a href="noaccess.html" class="nav-item">
                <div class="nav-item-icon">‚ù§Ô∏è</div>
                <div class="nav-item-text">Smash/Pass</div>
            </a>
            <a href="noaccess.html" class="nav-item">
                <div class="nav-item-icon">üì∏</div>
                <div class="nav-item-text">Amateur Content</div>
            </a>
        </div>

        <!-- Account -->
        <div class="nav-section">
            <div class="nav-section-title">Account</div>
            <a href="fehler.html" class="nav-item ">
                <div class="nav-item-icon">üë§</div>
                <div class="nav-item-text">Profil</div>
            </a>
            <a href="javascript:SignOut()" class="nav-item">
                <div class="nav-item-icon">üö™</div>
                <div class="nav-item-text">Logout</div>
            </a>
        </div>
    </nav>

    <!-- Sidebar Toggle -->
    <div class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-chevron-left text-white"></i>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">

    <script>
        
        // Sidebar Toggle
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const toggleIcon = sidebarToggle.querySelector('i');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const mobileSidebarToggle = document.getElementById('mobileSidebarToggle');

        // Desktop Toggle
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            if (sidebar.classList.contains('collapsed')) {
                toggleIcon.classList.remove('fa-chevron-left');
                toggleIcon.classList.add('fa-chevron-right');
            } else {
                toggleIcon.classList.remove('fa-chevron-right');
                toggleIcon.classList.add('fa-chevron-left');
            }
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        });

        // Mobile Toggle - mit Body Scroll Lock f√ºr iOS
        mobileSidebarToggle?.addEventListener('click', () => {
            sidebar.classList.toggle('mobile-open');
            mobileOverlay.classList.toggle('active');
            // Verhindere Body-Scroll wenn Sidebar offen
            if (sidebar.classList.contains('mobile-open')) {
                document.body.style.overflow = 'hidden';
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
                document.body.style.top = `-${window.scrollY}px`;
            } else {
                const scrollY = document.body.style.top;
                document.body.style.overflow = '';
                document.body.style.position = '';
                document.body.style.width = '';
                document.body.style.top = '';
                window.scrollTo(0, parseInt(scrollY || '0') * -1);
            }
        });

        mobileOverlay.addEventListener('click', () => {
            sidebar.classList.remove('mobile-open');
            mobileOverlay.classList.remove('active');
            // Body-Scroll wieder aktivieren
            const scrollY = document.body.style.top;
            document.body.style.overflow = '';
            document.body.style.position = '';
            document.body.style.width = '';
            document.body.style.top = '';
            window.scrollTo(0, parseInt(scrollY || '0') * -1);
        });

        // Remember sidebar state
        const sidebarCollapsed = localStorage.getItem('sidebarCollapsed');
        if (sidebarCollapsed === 'true') {
            sidebar.classList.add('collapsed');
            toggleIcon.classList.remove('fa-chevron-left');
            toggleIcon.classList.add('fa-chevron-right');
        }

        // iOS Safari: Verhindere Scroll-Bleeding von Sidebar zur Hauptseite
        sidebar.addEventListener('touchmove', function(e) {
            // Erlaube Scrollen nur wenn Sidebar scrollbar ist
            const isScrollable = sidebar.scrollHeight > sidebar.clientHeight;
            const isAtTop = sidebar.scrollTop === 0;
            const isAtBottom = sidebar.scrollTop + sidebar.clientHeight >= sidebar.scrollHeight;
            
            // Bestimme Scroll-Richtung
            const touch = e.touches[0];
            const lastTouchY = sidebar._lastTouchY || touch.clientY;
            const deltaY = lastTouchY - touch.clientY;
            sidebar._lastTouchY = touch.clientY;
            
            // Verhindere Scroll wenn am Ende/Anfang und in diese Richtung gescrollt wird
            if (!isScrollable || (isAtTop && deltaY < 0) || (isAtBottom && deltaY > 0)) {
                e.preventDefault();
            }
        }, { passive: false });
        
        sidebar.addEventListener('touchstart', function(e) {
            sidebar._lastTouchY = e.touches[0].clientY;
        }, { passive: true });

        // Categories Dropdown Toggle
        const categoriesToggle = document.getElementById('categoriesToggle');
        const categoriesSubmenu = document.getElementById('categoriesSubmenu');

        if (categoriesToggle && categoriesSubmenu) {
            // Check if any category is active and expand automatically
            const hasActiveCategory = categoriesSubmenu.querySelector('.nav-item.active');
            if (hasActiveCategory) {
                categoriesSubmenu.classList.add('active');
                categoriesToggle.classList.add('expanded');
                console.log('Auto-expanded categories because active category found');
            }

            categoriesToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                const isActive = categoriesSubmenu.classList.toggle('active');
                categoriesToggle.classList.toggle('expanded');

                console.log('Categories dropdown toggled:', isActive ? 'open' : 'closed');
            });

            // Log to verify element exists
            console.log('Categories toggle initialized');
        } else {
            console.error('Categories elements not found!', {
                toggle: !!categoriesToggle,
                submenu: !!categoriesSubmenu
            });
        }

        // Search Autocomplete
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search');
            const searchResults = document.getElementById('search-results');
            const searchResultsContainer = searchResults?.querySelector('.search-results-container');
            let searchTimeout;

            if (searchInput && searchResults && searchResultsContainer) {
                searchInput.addEventListener('input', function() {
                    const query = this.value.trim();

                    clearTimeout(searchTimeout);

                    if (query.length < 2) {
                        searchResults.classList.add('hidden');
                        return;
                    }

                    searchTimeout = setTimeout(() => {
                        const xhr = new XMLHttpRequest();
                        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                        xhr.onload = function() {
                            if (xhr.status === 200) {
                                try {
                                    const results = JSON.parse(xhr.responseText);

                                    if (results.error) {
                                        searchResults.classList.add('hidden');
                                        return;
                                    }

                                    if (results && results.length > 0) {
                                        searchResultsContainer.innerHTML = results.map(result => `
                                            <a href="/gallery?post_id=${result.id}"
                                               class="block px-4 py-3 text-white hover:bg-[#373747] transition-colors" style="text-decoration: none;">
                                                <div class="flex items-center gap-3">
                                                    ${result.thumbnail ?
                                                        `<img src="./uploads/${result.thumbnail}" alt="${result.title}" class="w-10 h-10 rounded object-cover flex-shrink-0">` :
                                                        `<i class="fas fa-image text-gray-400 w-10 h-10 flex items-center justify-center"></i>`
                                                    }
                                                    <span class="flex-1 truncate">${result.title}</span>
                                                </div>
                                            </a>
                                        `).join('');
                                        searchResults.classList.remove('hidden');
                                    } else {
                                        searchResults.classList.add('hidden');
                                    }
                                } catch (e) {
                                    searchResults.classList.add('hidden');
                                }
                            }
                        };

                        xhr.onerror = function() {
                            searchResults.classList.add('hidden');
                        };

                        xhr.send('query=' + encodeURIComponent(query));
                    }, 300);
                });

                // Hide results when clicking outside
                document.addEventListener('click', function(e) {
                    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                        searchResults.classList.add('hidden');
                    }
                });
            }
        });

        // Notification System
        let notificationUpdateInterval = null;
        
        function toggleNotificationDropdown(event) {
            event.stopPropagation();
            const isMobile = window.innerWidth < 768;
            const dropdown = isMobile ? document.getElementById('mobileNotificationDropdown') : document.getElementById('desktopNotificationDropdown');
            const bellButton = event.currentTarget;
            const isOpen = dropdown.classList.contains('show');
            
            // Schlie√üe alle Dropdowns
            document.querySelectorAll('.notification-dropdown').forEach(d => {
                d.classList.remove('show');
                d.style.left = '';
                d.style.top = '';
                d.style.right = '';
                d.style.display = '';
            });
            
            if (!isOpen) {
                // Desktop: Verschiebe Dropdown au√üerhalb der Sidebar ins Body
                if (!isMobile) {
                    const bellRect = bellButton.getBoundingClientRect();
                    const sidebar = document.getElementById('sidebar');
                    
                    // Verschiebe Dropdown ins Body, falls es noch in der Sidebar ist
                    if (dropdown.parentElement && dropdown.parentElement.closest('.sidebar')) {
                        document.body.appendChild(dropdown);
                    }
                    
                    if (sidebar) {
                        const sidebarRect = sidebar.getBoundingClientRect();
                        dropdown.style.position = 'fixed';
                        dropdown.style.left = (sidebarRect.right + 8) + 'px';
                        dropdown.style.top = bellRect.top + 'px';
                        dropdown.style.right = 'auto';
                        dropdown.style.zIndex = '10001';
                        dropdown.style.display = 'block';
                    }
                }
                
                // Zeige Dropdown
                dropdown.classList.add('show');
                
                // Pr√ºfe Position nach Rendering (nur Desktop)
                if (!isMobile) {
                    setTimeout(() => {
                        const dropdownRect = dropdown.getBoundingClientRect();
                        const sidebar = document.getElementById('sidebar');
                        if (sidebar) {
                            const sidebarRect = sidebar.getBoundingClientRect();
                            
                            // Pr√ºfe ob Dropdown √ºber den rechten Bildschirmrand hinausgeht
                            if (dropdownRect.right > window.innerWidth - 20) {
                                dropdown.style.left = 'auto';
                                dropdown.style.right = (window.innerWidth - sidebarRect.left + 8) + 'px';
                            }
                            
                            // Pr√ºfe ob Dropdown √ºber den unteren Bildschirmrand hinausgeht
                            if (dropdownRect.bottom > window.innerHeight - 20) {
                                dropdown.style.top = (window.innerHeight - dropdownRect.height - 20) + 'px';
                            }
                            
                            // Pr√ºfe ob Dropdown √ºber den oberen Bildschirmrand hinausgeht
                            if (dropdownRect.top < 20) {
                                dropdown.style.top = '20px';
                            }
                        }
                    }, 50);
                }
                
                loadNotifications();
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Schlie√üe Dropdown beim Klick au√üerhalb
        document.addEventListener('click', function(e) {
            const bellContainer = e.target.closest('.notification-bell-container');
            const dropdown = e.target.closest('.notification-dropdown');
            const actionBtn = e.target.closest('.notification-action-btn');
            const headerBtn = e.target.closest('.notification-mark-all, .notification-delete-all');
            
            // Schlie√üe nicht, wenn auf Bell, Dropdown, Action-Button oder Header-Button geklickt wird
            if (bellContainer || dropdown || actionBtn || headerBtn) {
                return;
            }
            
            // Schlie√üe alle Dropdowns
            document.querySelectorAll('.notification-dropdown').forEach(d => {
                d.classList.remove('show');
                d.style.display = '';
            });
        });
        
        // Lade Notifications beim Seitenaufruf
        document.addEventListener('DOMContentLoaded', function() {
            loadNotifications();
            
            // Aktualisiere alle 30 Sekunden
            notificationUpdateInterval = setInterval(() => {
                loadNotifications();
            }, 30000);
        });
    </script>
</body>